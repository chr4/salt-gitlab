gitlab:
  # Specify edition: "gitlab-ce" (default) or "gitlab-ee"
  edition: gitlab-ce

  config: |
    # Configure Gitlab to use SSL
    external_url 'https://gitlab.example.com'

    letsencrypt['enable'] = true
    letsencrypt['contact_emails'] = ['hostmaster@example.com']

    # Listen on ipv4 and ipv6
    nginx['listen_addresses'] = ['0.0.0.0', '[::]']

    # Use modern ciphers (See https://wiki.mozilla.org/Security/Server_Side_TLS)
    nginx['ssl_protocols'] = 'TLSv1.2 TLSv1.3'
    nginx['ssl_ciphers'] = 'ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256'
    nginx['ssl_prefer_server_ciphers'] = 'on'

    # Enable HSTS
    nginx['hsts_max_age'] = 31536000
    nginx['hsts_include_subdomains'] = false

    # Change default theme to light
    gitlab_rails['gitlab_default_theme'] = 3

  registry:
    garbage_collect:
      # Delete manifests that are not currenetly referenced via tag
      # This will set the -m option for "gitlab-ctl registry-garbage-collect"
      manifests: true

      # Run at a specific time, defaults to 02:00 every night
      on_calendar: 02:00
